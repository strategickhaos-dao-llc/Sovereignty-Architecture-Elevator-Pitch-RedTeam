<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legends of Minds - Control Center</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #0f0;
            border-bottom: 2px solid #0f0;
            padding-bottom: 10px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #0f0;
        }
        
        h3 {
            color: #0ff;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        
        .section {
            background: rgba(0, 255, 0, 0.05);
            border: 1px solid #0f0;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        button {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 5px;
            border-radius: 3px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #0f0;
            color: #000;
            box-shadow: 0 0 10px #0f0;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .status-box {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #0f0;
            padding: 15px;
            margin-top: 10px;
            border-radius: 3px;
            min-height: 50px;
            font-size: 12px;
            overflow-x: auto;
        }
        
        .verified {
            color: #0f0;
        }
        
        .warning {
            color: #ff0;
        }
        
        .error {
            color: #f00;
        }
        
        .info {
            color: #0ff;
        }
        
        input, textarea, select {
            background: #000;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 8px;
            font-family: 'Courier New', monospace;
            margin: 5px 0;
            width: 100%;
            max-width: 500px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            border: 1px solid #0f0;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background: rgba(0, 255, 0, 0.1);
            color: #0ff;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .card {
            background: rgba(0, 255, 0, 0.05);
            border: 1px solid #0f0;
            padding: 15px;
            border-radius: 5px;
        }
        
        .card h4 {
            color: #0ff;
            margin-bottom: 10px;
        }
        
        pre {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border: 1px solid #0f0;
            border-radius: 3px;
            overflow-x: auto;
            font-size: 11px;
        }
        
        .loading {
            display: inline-block;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è LEGENDS OF MINDS - CONTROL CENTER</h1>
        
        <div class="section">
            <h3>üìä System Status</h3>
            <button onclick="checkSystemHealth()">Check System Health</button>
            <div id="systemStatus" class="status-box">Click "Check System Health" to verify all services...</div>
        </div>
        
        <div class="section">
            <h3>üõ°Ô∏è Safety & Transparency Verification</h3>
            <p>Run comprehensive safety checks on your local AI system:</p>
            <div style="margin: 10px 0;">
                <button onclick="runSafetyCheck()">üîç Run Full Safety Verification</button>
                <button onclick="checkModelIntegrity()">üì¶ Model Integrity</button>
                <button onclick="checkProcessIsolation()">üîí Process Isolation</button>
                <button onclick="checkNetworkIsolation()">üåê Network Isolation</button>
                <button onclick="runCanaryTest()">üê§ Canary Test</button>
            </div>
            <div id="safetyReport" class="status-box">No safety check run yet...</div>
        </div>
        
        <div class="section">
            <h3>ü§ñ Model Interaction</h3>
            <div>
                <label>Model:</label>
                <select id="modelSelect" onchange="loadModels()">
                    <option>omegaheir_zero</option>
                </select>
                <button onclick="loadModels()">Refresh Models</button>
            </div>
            <div style="margin-top: 10px;">
                <label>Prompt:</label>
                <textarea id="promptInput" rows="4" placeholder="Enter your prompt here..."></textarea>
            </div>
            <button onclick="generateText()">Generate</button>
            <div id="generationOutput" class="status-box">Output will appear here...</div>
        </div>
        
        <div class="section">
            <h3>üìÅ File Ingestion</h3>
            <div>
                <input type="file" id="fileInput" />
                <button onclick="uploadFile()">Upload File</button>
            </div>
            <button onclick="listFiles()">List Uploaded Files</button>
            <div id="filesList" class="status-box">Click "List Uploaded Files" to see your uploads...</div>
        </div>
        
        <div class="section">
            <h3>üìà Resource Monitoring</h3>
            <button onclick="checkResourceUsage()">Check Resource Usage</button>
            <div id="resourceUsage" class="status-box">Click to view CPU, RAM, and GPU usage...</div>
        </div>
        
        <div class="section">
            <h3>‚ÑπÔ∏è System Information</h3>
            <div class="grid">
                <div class="card">
                    <h4>Control Center</h4>
                    <p>API: <a href="http://localhost:8080/docs" style="color: #0ff;">http://localhost:8080/docs</a></p>
                    <p>Status: <span id="controlCenterStatus" class="loading">Checking...</span></p>
                </div>
                <div class="card">
                    <h4>File Ingest</h4>
                    <p>API: <a href="http://localhost:8001/docs" style="color: #0ff;">http://localhost:8001/docs</a></p>
                    <p>Status: <span id="ingestStatus" class="loading">Checking...</span></p>
                </div>
                <div class="card">
                    <h4>Qdrant Vector DB</h4>
                    <p>UI: <a href="http://localhost:6334" style="color: #0ff;">http://localhost:6334</a></p>
                    <p>Status: <span id="qdrantStatus" class="loading">Checking...</span></p>
                </div>
                <div class="card">
                    <h4>Ollama LLM</h4>
                    <p>API: <a href="http://localhost:11434" style="color: #0ff;">http://localhost:11434</a></p>
                    <p>Status: <span id="ollamaStatus" class="loading">Checking...</span></p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Configuration
        const API_BASE = 'http://localhost:8080';
        const INGEST_BASE = 'http://localhost:8001';
        
        // Initialize on load
        window.addEventListener('load', () => {
            checkSystemHealth();
            loadModels();
        });
        
        // System health check
        async function checkSystemHealth() {
            const statusDiv = document.getElementById('systemStatus');
            statusDiv.innerHTML = '<span class="info loading">‚è≥ Checking system health...</span>';
            
            try {
                const resp = await fetch(`${API_BASE}/health`);
                const data = await resp.json();
                
                let html = `<div><strong>Overall Status: <span class="${data.status === 'healthy' ? 'verified' : 'warning'}">${data.status.toUpperCase()}</span></strong><br>`;
                html += `Timestamp: ${data.timestamp}<br><br>`;
                html += '<strong>Services:</strong><br>';
                
                for (const [service, status] of Object.entries(data.services)) {
                    const statusClass = status === 'healthy' ? 'verified' : 'error';
                    html += `<span class="${statusClass}">‚Ä¢ ${service}: ${status}</span><br>`;
                }
                
                html += '</div>';
                statusDiv.innerHTML = html;
                
                // Update individual status indicators
                document.getElementById('controlCenterStatus').innerHTML = '<span class="verified">‚úì Online</span>';
                document.getElementById('ollamaStatus').innerHTML = data.services.ollama === 'healthy' 
                    ? '<span class="verified">‚úì Online</span>' 
                    : '<span class="error">‚úó Offline</span>';
                document.getElementById('qdrantStatus').innerHTML = data.services.qdrant === 'healthy' 
                    ? '<span class="verified">‚úì Online</span>' 
                    : '<span class="error">‚úó Offline</span>';
                    
            } catch (err) {
                statusDiv.innerHTML = `<span class="error">‚úó Error: ${err.message}</span>`;
                document.getElementById('controlCenterStatus').innerHTML = '<span class="error">‚úó Offline</span>';
            }
            
            // Check ingest service separately
            try {
                const resp = await fetch(`${INGEST_BASE}/health`);
                const data = await resp.json();
                document.getElementById('ingestStatus').innerHTML = data.status === 'healthy' 
                    ? '<span class="verified">‚úì Online</span>' 
                    : '<span class="warning">‚ö† Degraded</span>';
            } catch (err) {
                document.getElementById('ingestStatus').innerHTML = '<span class="error">‚úó Offline</span>';
            }
        }
        
        // Full safety verification
        async function runSafetyCheck() {
            const reportDiv = document.getElementById('safetyReport');
            reportDiv.innerHTML = '<span class="info loading">‚è≥ Running comprehensive safety verification...</span>';
            
            try {
                const resp = await fetch(`${API_BASE}/api/safety/full_report`);
                const data = await resp.json();
                
                let html = `<div><strong>Overall Status: <span class="${data.overall_status === 'VERIFIED' ? 'verified' : 'warning'}">${data.overall_status}</span></strong><br>`;
                html += `Time: ${data.timestamp}<br><br>`;
                html += '<strong>Verification Results:</strong><br><br>';
                
                for (const [check, result] of Object.entries(data.checks)) {
                    const status = result.status || 'unknown';
                    const color = status === 'verified' ? 'verified' : status === 'warning' ? 'warning' : 'error';
                    html += `<div style="margin: 5px 0;">`;
                    html += `<span class="${color}">‚Ä¢ ${check.replace(/_/g, ' ').toUpperCase()}: ${status.toUpperCase()}</span>`;
                    if (result.message) {
                        html += `<br>  <span class="info">${result.message}</span>`;
                    }
                    html += `</div>`;
                }
                
                html += '</div>';
                reportDiv.innerHTML = html;
            } catch (err) {
                reportDiv.innerHTML = `<span class="error">‚úó Error: ${err.message}</span>`;
            }
        }
        
        // Individual safety checks
        async function checkModelIntegrity() {
            const reportDiv = document.getElementById('safetyReport');
            reportDiv.innerHTML = '<span class="info loading">‚è≥ Checking model integrity...</span>';
            
            try {
                const resp = await fetch(`${API_BASE}/api/safety/model_integrity`);
                const data = await resp.json();
                
                if (data.error) {
                    reportDiv.innerHTML = `<span class="warning">‚ö† ${data.error}</span>`;
                    return;
                }
                
                let html = `<strong class="verified">Model Integrity Check: PASSED</strong><br>`;
                html += `Models found: ${data.models_found}<br><br>`;
                
                if (data.models && data.models.length > 0) {
                    html += '<table><tr><th>File</th><th>Size (MB)</th><th>SHA256</th><th>Read-Only</th></tr>';
                    for (const model of data.models) {
                        html += `<tr>`;
                        html += `<td>${model.file}</td>`;
                        html += `<td>${model.size_mb.toFixed(2)}</td>`;
                        html += `<td>${model.sha256}</td>`;
                        html += `<td>${model.read_only ? 'Yes' : 'No'}</td>`;
                        html += `</tr>`;
                    }
                    html += '</table>';
                }
                
                reportDiv.innerHTML = html;
            } catch (err) {
                reportDiv.innerHTML = `<span class="error">‚úó Error: ${err.message}</span>`;
            }
        }
        
        async function checkProcessIsolation() {
            const reportDiv = document.getElementById('safetyReport');
            reportDiv.innerHTML = '<span class="info loading">‚è≥ Checking process isolation...</span>';
            
            try {
                const resp = await fetch(`${API_BASE}/api/safety/process_isolation`);
                const data = await resp.json();
                
                if (data.status === 'not_running') {
                    reportDiv.innerHTML = `<span class="warning">‚ö† ${data.message}</span>`;
                    return;
                }
                
                let html = `<strong class="verified">Process Isolation Check: PASSED</strong><br><br>`;
                html += `PID: ${data.process.pid}<br>`;
                html += `User: ${data.process.user}<br>`;
                html += `Localhost Only: ${data.process.localhost_only ? 'Yes' : 'No'}<br>`;
                html += `<br><strong>Listening Connections:</strong><br>`;
                
                for (const conn of data.process.connections) {
                    if (conn.error) {
                        html += `<span class="warning">${conn.error}</span><br>`;
                    } else {
                        html += `‚Ä¢ ${conn.address}:${conn.port} (${conn.localhost_only ? 'Localhost' : 'External'})<br>`;
                    }
                }
                
                reportDiv.innerHTML = html;
            } catch (err) {
                reportDiv.innerHTML = `<span class="error">‚úó Error: ${err.message}</span>`;
            }
        }
        
        async function checkNetworkIsolation() {
            const reportDiv = document.getElementById('safetyReport');
            reportDiv.innerHTML = '<span class="info loading">‚è≥ Checking network isolation...</span>';
            
            try {
                const resp = await fetch(`${API_BASE}/api/safety/network_isolation`);
                const data = await resp.json();
                
                if (data.error) {
                    reportDiv.innerHTML = `<span class="warning">‚ö† ${data.error}</span>`;
                    return;
                }
                
                const statusClass = data.status === 'verified' ? 'verified' : 'warning';
                let html = `<strong class="${statusClass}">Network Isolation: ${data.status.toUpperCase()}</strong><br>`;
                html += `Port: ${data.port}<br>`;
                html += `Active Connections: ${data.active_connections}<br>`;
                html += `External Connections: ${data.external_connections.length}<br>`;
                html += `Message: ${data.message}<br>`;
                
                if (data.external_connections.length > 0) {
                    html += '<br><strong class="warning">Warning: External Connections Detected:</strong><br>';
                    for (const conn of data.external_connections) {
                        html += `‚Ä¢ ${conn.local} ‚Üí ${conn.foreign}: ${conn.warning}<br>`;
                    }
                }
                
                reportDiv.innerHTML = html;
            } catch (err) {
                reportDiv.innerHTML = `<span class="error">‚úó Error: ${err.message}</span>`;
            }
        }
        
        async function runCanaryTest() {
            const reportDiv = document.getElementById('safetyReport');
            reportDiv.innerHTML = '<span class="info loading">‚è≥ Running canary tests (this may take a minute)...</span>';
            
            try {
                const resp = await fetch(`${API_BASE}/api/safety/canary_test`);
                const data = await resp.json();
                
                const statusClass = data.all_safe ? 'verified' : 'warning';
                let html = `<strong class="${statusClass}">Canary Test: ${data.status.toUpperCase()}</strong><br>`;
                html += `Tests Run: ${data.tests_run}<br>`;
                html += `All Safe: ${data.all_safe ? 'Yes' : 'No'}<br><br>`;
                
                html += '<strong>Test Results:</strong><br>';
                for (const result of data.results) {
                    if (result.error) {
                        html += `<div style="margin: 10px 0;"><span class="error">‚úó ${result.prompt}: ERROR</span><br>`;
                        html += `Error: ${result.error}</div>`;
                    } else {
                        const resultClass = result.safe ? 'verified' : 'warning';
                        html += `<div style="margin: 10px 0;"><span class="${resultClass}">${result.safe ? '‚úì' : '‚ö†'} ${result.prompt}</span><br>`;
                        html += `Response: ${result.response.substring(0, 150)}...<br>`;
                        if (!result.safe) {
                            html += `<span class="warning">Red Flags: ${JSON.stringify(result.red_flags)}</span>`;
                        }
                        html += '</div>';
                    }
                }
                
                reportDiv.innerHTML = html;
            } catch (err) {
                reportDiv.innerHTML = `<span class="error">‚úó Error: ${err.message}</span>`;
            }
        }
        
        // Resource monitoring
        async function checkResourceUsage() {
            const usageDiv = document.getElementById('resourceUsage');
            usageDiv.innerHTML = '<span class="info loading">‚è≥ Checking resource usage...</span>';
            
            try {
                const resp = await fetch(`${API_BASE}/api/safety/resource_usage`);
                const data = await resp.json();
                
                if (data.status === 'not_running') {
                    usageDiv.innerHTML = '<span class="warning">‚ö† Ollama not running</span>';
                    return;
                }
                
                let html = '<strong class="verified">Resource Usage:</strong><br><br>';
                html += `<strong>Process (PID ${data.process.pid}):</strong><br>`;
                html += `‚Ä¢ Memory: ${data.process.memory_mb.toFixed(2)} MB<br>`;
                html += `‚Ä¢ CPU: ${data.process.cpu_percent.toFixed(1)}%<br>`;
                html += `<br><strong>GPU:</strong><br>${data.gpu}<br>`;
                
                usageDiv.innerHTML = html;
            } catch (err) {
                usageDiv.innerHTML = `<span class="error">‚úó Error: ${err.message}</span>`;
            }
        }
        
        // Model interaction
        async function loadModels() {
            try {
                const resp = await fetch(`${API_BASE}/api/models`);
                const data = await resp.json();
                
                const select = document.getElementById('modelSelect');
                select.innerHTML = '';
                
                if (data.models && data.models.length > 0) {
                    for (const model of data.models) {
                        const option = document.createElement('option');
                        option.value = model.name;
                        option.textContent = model.name;
                        select.appendChild(option);
                    }
                }
            } catch (err) {
                console.error('Failed to load models:', err);
            }
        }
        
        async function generateText() {
            const model = document.getElementById('modelSelect').value;
            const prompt = document.getElementById('promptInput').value;
            const outputDiv = document.getElementById('generationOutput');
            
            if (!prompt.trim()) {
                outputDiv.innerHTML = '<span class="warning">‚ö† Please enter a prompt</span>';
                return;
            }
            
            outputDiv.innerHTML = '<span class="info loading">‚è≥ Generating response...</span>';
            
            try {
                const resp = await fetch(`${API_BASE}/api/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ model, prompt, stream: false })
                });
                
                const data = await resp.json();
                outputDiv.innerHTML = `<pre>${data.response || JSON.stringify(data, null, 2)}</pre>`;
            } catch (err) {
                outputDiv.innerHTML = `<span class="error">‚úó Error: ${err.message}</span>`;
            }
        }
        
        // File ingestion
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const filesList = document.getElementById('filesList');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                filesList.innerHTML = '<span class="warning">‚ö† Please select a file</span>';
                return;
            }
            
            filesList.innerHTML = '<span class="info loading">‚è≥ Uploading file...</span>';
            
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('collection', 'default');
            
            try {
                const resp = await fetch(`${INGEST_BASE}/api/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await resp.json();
                
                if (data.status === 'success') {
                    filesList.innerHTML = `<span class="verified">‚úì ${data.message}</span><br>File ID: ${data.file_id}<br>Size: ${data.size} bytes`;
                    fileInput.value = '';
                } else {
                    filesList.innerHTML = `<span class="error">‚úó Upload failed</span>`;
                }
            } catch (err) {
                filesList.innerHTML = `<span class="error">‚úó Error: ${err.message}</span>`;
            }
        }
        
        async function listFiles() {
            const filesList = document.getElementById('filesList');
            filesList.innerHTML = '<span class="info loading">‚è≥ Loading files...</span>';
            
            try {
                const resp = await fetch(`${INGEST_BASE}/api/files`);
                const data = await resp.json();
                
                if (data.count === 0) {
                    filesList.innerHTML = '<span class="info">No files uploaded yet</span>';
                    return;
                }
                
                let html = `<strong>Total Files: ${data.count}</strong><br><br>`;
                html += '<table><tr><th>Filename</th><th>Size</th><th>Uploaded</th><th>Collection</th></tr>';
                
                for (const file of data.files) {
                    html += '<tr>';
                    html += `<td>${file.filename}</td>`;
                    html += `<td>${file.size} bytes</td>`;
                    html += `<td>${new Date(file.uploaded_at).toLocaleString()}</td>`;
                    html += `<td>${file.collection}</td>`;
                    html += '</tr>';
                }
                
                html += '</table>';
                filesList.innerHTML = html;
            } catch (err) {
                filesList.innerHTML = `<span class="error">‚úó Error: ${err.message}</span>`;
            }
        }
    </script>
</body>
</html>
