# Yamal Immune Stack - Sample ImmuneSystem Configuration
# This CR implements a biological immune model for self-healing swarm infrastructure
#
# Biology â†’ Infrastructure Mapping:
# â”œâ”€â”€ DNA          â†’ Container images (immutable blueprints)
# â”œâ”€â”€ Cells        â†’ Running containers
# â”œâ”€â”€ Tissue       â†’ Pod groups / deployments
# â”œâ”€â”€ Organs       â†’ Namespaces / services
# â”œâ”€â”€ Bloodstream  â†’ Volumes + message buses
# â”œâ”€â”€ Bone Marrow  â†’ Image registry (spawns new cells)
# â”œâ”€â”€ Lymph Nodes  â†’ Qdrant/vector DBs (threat memory)
# â”œâ”€â”€ Skin         â†’ Ingress / firewall (first barrier)
# â”œâ”€â”€ Fever        â†’ Resource throttling under attack
# â””â”€â”€ Apoptosis    â†’ Graceful container termination

apiVersion: swarm.strategickhaos.ai/v1
kind: ImmuneSystem
metadata:
  name: yamal-immune
  namespace: ops
  labels:
    app: swarm-immune
    environment: production
  annotations:
    description: "Primary immune system for Strategickhaos production infrastructure"
spec:
  # ğŸ©¸ RED BLOOD CELLS (O2 Carriers)
  # Message queues and data transport between services
  # Carries compute payload to where it's needed
  redBloodCells:
    transport: redis
    volumeClass: fast-nvme
    replicationFactor: 3
    serializationFormat: protobuf
    healthCheckInterval: "5s"
  
  # ğŸ”¬ WHITE BLOOD CELLS (Immune Response)
  # Security scanners, auto-kill, garbage collection
  # Threat neutralization via network policy
  whiteBloodCells:
    scanner: trivy
    runtimeMonitor: falco
    responseTime: "5s"
    autoKill: true
    quarantineNamespace: infected
    garbageCollection:
      enabled: true
      schedule: "0 */4 * * *"
      retentionPeriod: "48h"
    networkPolicy:
      enabled: true
      defaultDeny: true
      allowedNamespaces:
        - "kube-system"
        - "monitoring"
        - "ops"
  
  # ğŸ›¡ï¸ ANTIBODIES (Pattern Memory)
  # Vector embeddings for learned threat signatures
  # Persistent across reboots (immune memory)
  antibodies:
    vectorDB: qdrant
    vectorDBEndpoint: "http://qdrant.ops.svc:6333"
    signatureRetention: "90d"
    learningMode: active
    imageAllowlist:
      - "ollama/*"
      - "strategickhaos/*"
      - "ghcr.io/strategickhaos-swarm-intelligence/*"
    behavioralFingerprints:
      enabled: true
      sensitivity: high
  
  # â˜€ï¸ğŸŒ™ CIRCADIAN RHYTHM (Day/Night Cycle)
  # Sunshine = active metabolism, GPU burst, high compute
  # Moonlight = low-power surveillance, batch jobs, healing
  circadianRhythm:
    enabled: true
    timezone: "America/Chicago"
    sunshineHours: "06:00-22:00"
    moonlightHours: "22:00-06:00"
    sunshineReplicas: 10
    moonlightReplicas: 2
    gpuBurst:
      enabled: true
      maxGPUs: 4
      burstThreshold: "80%"
  
  # ğŸš« AUTOIMMUNE PROTECTION
  # Prevent the immune system from attacking healthy components
  autoimmune:
    enabled: false
    trustedImages:
      - "ollama/*"
      - "strategickhaos/*"
      - "ghcr.io/strategickhaos-swarm-intelligence/*"
    trustedNamespaces:
      - "kube-system"
      - "cert-manager"
      - "ingress-nginx"
    selfHealingDelay: "30s"
  
  # ğŸ¤’ FEVER RESPONSE
  # Resource throttling when under active attack
  feverResponse:
    enabled: true
    triggerThreshold: 5
    throttlePercent: 50
    duration: "5m"
  
  # âš°ï¸ APOPTOSIS (Graceful Termination)
  # Programmed cell death for orderly replacement
  apoptosis:
    enabled: true
    gracePeriod: "30s"
    drainConnections: true
    preStopHook: "/bin/sh -c 'sleep 5'"
  
  # ğŸ¦´ BONE MARROW (Cell Factory)
  # Image registry - where new cells are born
  boneMarrow:
    registry: "ghcr.io/strategickhaos-swarm-intelligence"
    pullSecretRef: "ghcr-pull-secret"
    scanOnPush: true
    immutableTags: true
