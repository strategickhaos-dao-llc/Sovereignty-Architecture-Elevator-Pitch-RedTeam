# =============================================================================
# Security Hardening Configuration
# Sovereign Swarm - sysctl and kernel parameters
# =============================================================================

# IP Forwarding (required for WireGuard mesh)
net.ipv4.ip_forward=1
net.ipv6.conf.all.forwarding=1

# Source address validation (anti-spoofing)
net.ipv4.conf.all.rp_filter=1
net.ipv4.conf.default.rp_filter=1
net.ipv4.conf.all.src_valid_mark=1

# Disable ICMP redirects
net.ipv4.conf.all.accept_redirects=0
net.ipv4.conf.default.accept_redirects=0
net.ipv4.conf.all.send_redirects=0
net.ipv4.conf.default.send_redirects=0
net.ipv6.conf.all.accept_redirects=0
net.ipv6.conf.default.accept_redirects=0

# Disable source routing
net.ipv4.conf.all.accept_source_route=0
net.ipv4.conf.default.accept_source_route=0
net.ipv6.conf.all.accept_source_route=0
net.ipv6.conf.default.accept_source_route=0

# Enable SYN flood protection
net.ipv4.tcp_syncookies=1
net.ipv4.tcp_max_syn_backlog=2048
net.ipv4.tcp_synack_retries=2

# Ignore ICMP broadcast requests
net.ipv4.icmp_echo_ignore_broadcasts=1

# Ignore bogus error responses
net.ipv4.icmp_ignore_bogus_error_responses=1

# Log martians (packets with impossible addresses)
net.ipv4.conf.all.log_martians=1
net.ipv4.conf.default.log_martians=1

# TCP hardening
net.ipv4.tcp_rfc1337=1
net.ipv4.tcp_timestamps=0

# Increase TCP buffer sizes for WireGuard performance
net.core.rmem_max=26214400
net.core.wmem_max=26214400
net.core.rmem_default=1048576
net.core.wmem_default=1048576
net.ipv4.tcp_rmem=4096 1048576 26214400
net.ipv4.tcp_wmem=4096 1048576 26214400

# Connection tracking
net.netfilter.nf_conntrack_max=262144
net.netfilter.nf_conntrack_tcp_timeout_established=86400
