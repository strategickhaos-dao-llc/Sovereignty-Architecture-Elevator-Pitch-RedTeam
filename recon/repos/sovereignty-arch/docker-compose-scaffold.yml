version: "3.8"
services:
  vault:
    image: docker.io/hashicorp/vault:1.17
    environment:
      VAULT_DEV_ROOT_TOKEN_ID: ${VAULT_ROOT_TOKEN:-root}
      VAULT_DEV_LISTEN_ADDRESS: "0.0.0.0:8200"
    ports: ["8200:8200"]
    cap_add: ["IPC_LOCK"]
    restart: unless-stopped

  prometheus:
    image: docker.io/prom/prometheus:v2.55.0
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml:ro
    command: ["--config.file=/etc/prometheus/prometheus.yml"]
    ports: ["9090:9090"]
    restart: unless-stopped

  grafana:
    image: docker.io/grafana/grafana:11.2.0
    environment:
      GF_SECURITY_ADMIN_PASSWORD: ${GRAFANA_PASSWORD:-admin}
    ports: ["3000:3000"]
    volumes:
      - ./monitoring/grafana/:/etc/grafana/provisioning/
    depends_on: [prometheus]
    restart: unless-stopped

  loki:
    image: docker.io/grafana/loki:2.9.8
    command: ["-config.file=/etc/loki/local-config.yml"]
    ports: ["3100:3100"]
    volumes:
      - ./monitoring/loki-config.yml:/etc/loki/local-config.yml:ro
    restart: unless-stopped