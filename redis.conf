# redis.conf - CPU-Optimized Configuration for High Load Systems

# Network and Security
bind 0.0.0.0
port 6379
requirepass strategickhaos2024
protected-mode yes

# Memory and Performance Optimization for High CPU Load
maxmemory 200mb
maxmemory-policy allkeys-lru
save 900 1    # Save if at least 1 key changed in 900 seconds (15 min)
save 300 10   # Save if at least 10 keys changed in 300 seconds (5 min)
save 60 10000 # Save if at least 10000 keys changed in 60 seconds

# CPU Optimization - Reduce background processing
stop-writes-on-bgsave-error no
rdbcompression yes
rdbchecksum yes

# Reduce CPU usage during high load
hz 10                    # Background task frequency (default 10, lower = less CPU)
dynamic-hz yes           # Adapt hz based on connected clients

# Client Connection Limits (prevent resource exhaustion)
maxclients 100           # Limit concurrent connections
timeout 300              # Client idle timeout
tcp-keepalive 300

# Logging (minimal to reduce I/O during high CPU)
loglevel notice
syslog-enabled no

# Disable expensive features during high load
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# AOF disabled for CPU optimization (RDB only)
appendonly no

# Slow log configuration
slowlog-log-slower-than 10000
slowlog-max-len 128

# Replica configuration (if needed)
replica-read-only yes
replica-serve-stale-data yes

# Memory defragmentation (careful with CPU usage)
activedefrag no          # Disable during high CPU usage

# Client output buffer limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60